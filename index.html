<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Analyse Vid√©o - √âtudiant</title>
    <style>
        body { font-family: sans-serif; padding: 20px; line-height: 1.6; }
        .box { border: 1px solid #ccc; padding: 15px; border-radius: 8px; background: #f9f9f9; max-width: 600px; }
        input { width: 100%; padding: 8px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        #statut-envoi { color: #666; font-style: italic; margin-left: 10px; }
    </style>
</head>
<body>

    <h1>Analyse Vid√©o & Logigramme</h1>

    <!-- SECTION LOGIGRAMME (Simulation de votre outil actuel) -->
    <div id="logigramme-container" class="box">
        <p>Effectuez votre analyse ici...</p>
        <!-- Votre grille d'analyse existante reste ici -->
    </div>

    <br>

    <!-- SECTION ENVOI SUPABASE -->
    <div id="section-envoi" class="box">
        <h3>Transmettre mon analyse</h3>
        <label for="etudiant-nom">Nom complet :</label>
        <input id="etudiant-nom" placeholder="Ex: Jean Tremblay" />
        
        <label for="video-url">Lien YouTube de votre analyse :</label>
        <input id="video-url" placeholder="https://www.youtube.com..." />
        
        <label for="student-comment">R√©sum√© / Commentaires :</label>
        <textarea id="student-comment" style="width:100%; height:80px;"></textarea>
        
        <br><br>
        <button onclick="envoyerAnalyse()">Envoyer au professeur</button>
        <span id="statut-envoi" style="display:none;">üì§ Envoi en cours...</span>
    </div>
<!-- SECTION : CONSULTER MES R√âSULTATS -->
<div id="section-resultats" class="box" style="margin-top:20px; border-top: 3px solid #28a745;">
    <h3>Consulter ma correction</h3>
    <p>Entrez votre nom pour voir le feedback du professeur.</p>
    <input id="check-nom" placeholder="Votre nom complet (tel qu'envoy√©)" />
    <button onclick="consulterCorrection()">Voir mon feedback</button>
    
    <div id="display-feedback" style="display:none; margin-top:15px; padding:15px; background:#e7f1ff; border-radius:5px; border-left: 5px solid #007bff;">
        <strong>Correction du professeur :</strong>
        <p id="feedback-text" style="white-space: pre-wrap; font-style: italic; color: #333;"></p>
    </div>
</div>
    <!-- CONNEXION SUPABASE -->
    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net'

        // REMPLACEZ PAR VOS CL√âS SUPABASE (Settings > API)
        const SUPABASE_URL = 'https://wvmsigeoqmrihsisrfnj.supabase.co'
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind2bXNpZ2VvcW1yaWhzaXNyZm5qIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIxNTczMjcsImV4cCI6MjA4NzczMzMyN30.bIVeDCh8ULtyICJv8oZfLiE1pi3bNS0h3L2JGgvfFBU'
        const supabase = createClient(SUPABASE_URL, SUPABASE_KEY)

        async function envoyerAnalyse() {
            const nom = document.getElementById('etudiant-nom').value;
            const url = document.getElementById('video-url').value;
            const comm = document.getElementById('student-comment').value;
            const statut = document.getElementById('statut-envoi');
            
            // On r√©cup√®re votre variable "choices" (si elle existe dans votre code)
            const donneesLogigramme = window.choices || { info: "Aucune donn√©e de logigramme d√©tect√©e" };

            if (!nom || !url) {
                alert("Veuillez entrer votre nom et le lien de la vid√©o.");
                return;
            }

            statut.style.display = "inline";

            const { data, error } = await supabase
                .from('analyses')
                .insert([{ 
                    student_name: nom, 
                    video_url: url,
                    student_comment: comm,
                    choices_json: donneesLogigramme 
                }]);

            statut.style.display = "none";

            if (error) {
                console.error("Erreur:", error);
                alert("Erreur lors de l'envoi : " + error.message);
            } else {
                alert("Succ√®s ! Votre analyse a √©t√© transmise.");
                document.getElementById('etudiant-nom').value = "";
                document.getElementById('video-url').value = "";
            }
        }
        window.envoyerAnalyse = envoyerAnalyse;
 // --- AJOUT DE LA FONCTION DE CONSULTATION ---
    async function consulterCorrection() {
        const nom = document.getElementById('check-nom').value;
        if (!nom) return alert("Veuillez entrer votre nom.");

        const { data, error } = await supabase
            .from('analyses')
            .select('teacher_feedback')
            .eq('student_name', nom)
            .order('created_at', { ascending: false })
            .limit(1);

        const box = document.getElementById('display-feedback');
        const text = document.getElementById('feedback-text');

        if (error) {
            alert("Erreur lors de la recherche.");
        } else if (data && data.length > 0) {
            const feedback = data[0].teacher_feedback; // Note: on ajoute [0] ici
            box.style.display = "block";
            text.innerText = feedback || "Votre analyse a √©t√© re√ßue, mais elle n'est pas encore corrig√©e. Revenez plus tard !";
        } else {
            alert("Aucune analyse trouv√©e √† ce nom.");
            box.style.display = "none";
        }
    }

    // Indispensable pour que le bouton HTML puisse appeler la fonction
    window.consulterCorrection = consulterCorrection;
    // --- FIN DE L'AJOUT ---
    </script>
</body>
</html>
Use code with caution.

√âtape 2 : Le fichier dashboard.html (Votre interface Prof)
Cr√©ez un nouveau fichier nomm√© dashboard.html dans le m√™me dossier et collez-y ceci :
html
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Tableau de Bord Professeur</title>
    <style>
        body { font-family: sans-serif; display: flex; height: 100vh; margin: 0; }
        #sidebar { width: 300px; border-right: 1px solid #ccc; overflow-y: auto; padding: 15px; background: #f4f4f4; }
        #viewer { flex-grow: 1; padding: 20px; display: flex; flex-direction: column; }
        .student-item { padding: 10px; border-bottom: 1px solid #ddd; cursor: pointer; }
        .student-item:hover { background: #e0e0e0; }
        iframe { width: 100%; height: 400px; border: none; background: #000; }
        textarea { width: 100%; height: 100px; margin-top: 10px; }
    </style>
</head>
<body>

    <div id="sidebar">
        <h2>√âtudiants</h2>
        <div id="student-list">Chargement...</div>
    </div>

    <div id="viewer">
        <h2 id="current-student">S√©lectionnez un √©tudiant</h2>
        <div id="video-container"></div>
        <div id="analysis-results" style="margin-top:20px; padding:10px; background:#eee;">
            <strong>Analyse du logigramme :</strong>
            <pre id="json-display">Cliquez sur un √©tudiant pour voir ses choix.</pre>
        </div>
        <textarea id="feedback" placeholder="√âcrivez votre correction ici..."></textarea>
        <button id="save-btn" style="margin-top:10px; padding:10px; background:green; color:white; border:none; cursor:pointer;">Enregistrer la correction</button>
    </div>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net'

        const SUPABASE_URL = 'https://VOTRE_ID_PROJET.supabase.co'
        const SUPABASE_KEY = 'VOTRE_CLE_ANON'
        const supabase = createClient(SUPABASE_URL, SUPABASE_KEY)

        let selectedId = null;

        async function loadAnalyses() {
            const { data, error } = await supabase.from('analyses').select('*').order('created_at', { ascending: false });
            const list = document.getElementById('student-list');
            list.innerHTML = "";
            data.forEach(item => {
                const div = document.createElement('div');
                div.className = "student-item";
                div.innerText = item.student_name;
                div.onclick = () => showDetail(item);
                list.appendChild(div);
            });
        }

        function showDetail(item) {
            selectedId = item.id;
            document.getElementById('current-student').innerText = item.student_name;
            document.getElementById('json-display').innerText = JSON.stringify(item.choices_json, null, 2);
            document.getElementById('feedback').value = item.teacher_feedback || "";
            
            // Transformation lien YouTube en Embed
            const videoId = item.video_url.split('v=')[1]?.split('&')[0] || item.video_url.split('/').pop();
            document.getElementById('video-container').innerHTML = `<iframe src="https://www.youtube.com{videoId}" allowfullscreen></iframe>`;
        }

        document.getElementById('save-btn').onclick = async () => {
            if (!selectedId) return;
            const feedbackText = document.getElementById('feedback').value;
            const { error } = await supabase.from('analyses').update({ teacher_feedback: feedbackText }).eq('id', selectedId);
            if (error) alert("Erreur lors de la sauvegarde");
            else alert("Correction enregistr√©e !");
        };

        loadAnalyses();
    </script>
</body>
</html>